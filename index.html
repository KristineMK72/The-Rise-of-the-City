<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>The Rise of the City</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
  html, body {
    height: 100%;
    margin: 0;
    background: #000;
    font-family: "Segoe UI", sans-serif;
  }

  header {
    text-align: center;
    padding: 1rem;
    background: rgba(0,0,0,0.8);
    color: #fff;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1000;
  }

  #map {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    z-index: 1;
    filter: brightness(0.4);
    transition: filter 2s ease-in-out;
  }

  .decade-label {
    position: absolute;
    bottom: 90px;
    right: 60px;
    background: rgba(0, 0, 0, 0.7);
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 1.6rem;
    color: #fff;
    font-weight: bold;
    z-index: 9999;
    letter-spacing: 2px;
  }

  /* Urbanization scale */
  .scale-container {
    position: absolute;
    bottom: 40px;
    left: 60px;
    width: 220px;
    height: 15px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
    z-index: 9999;
  }

  .scale-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #ff9900, #ffd500, #ffffff);
    box-shadow: 0 0 20px #ffaa00;
    transition: width 2s ease-in-out;
  }

  .city-glow {
    width: 16px;
    height: 16px;
    background: radial-gradient(circle, rgba(255,200,0,1) 0%, rgba(255,150,0,0.8) 50%, rgba(255,150,0,0) 80%);
    border-radius: 50%;
    opacity: 0;
    transition: opacity 2s ease-in-out;
  }
</style>
</head>

<body>
  <header>
    <h1>ðŸŒ† The Rise of the City: 1950â€“2020</h1>
    <p>Urbanization glowing through the decades</p>
  </header>

  <div id="map"></div>
  <div id="decade" class="decade-label">1950</div>

  <div class="scale-container">
    <div class="scale-fill" id="scaleFill"></div>
  </div>

  <script>
    // Initialize map
    const map = L.map('map', {
      center: [39.8283, -98.5795],
      zoom: 4,
      zoomControl: false
    });

    // Base layer
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap & CARTO'
    }).addTo(map);

    // Hardcoded city growth data
    const cityGrowth = {
      1950: [
        { name: "New York", coords: [40.7128, -74.0060] },
        { name: "Chicago", coords: [41.8781, -87.6298] },
        { name: "Los Angeles", coords: [34.0522, -118.2437] }
      ],
      1970: [
        { name: "Houston", coords: [29.7604, -95.3698] },
        { name: "Dallas", coords: [32.7767, -96.7970] },
        { name: "San Francisco", coords: [37.7749, -122.4194] }
      ],
      1990: [
        { name: "Miami", coords: [25.7617, -80.1918] },
        { name: "Atlanta", coords: [33.7490, -84.3880] },
        { name: "Seattle", coords: [47.6062, -122.3321] }
      ],
      2010: [
        { name: "Denver", coords: [39.7392, -104.9903] },
        { name: "Phoenix", coords: [33.4484, -112.0740] },
        { name: "Las Vegas", coords: [36.1699, -115.1398] }
      ],
      2020: [
        { name: "Austin", coords: [30.2672, -97.7431] },
        { name: "Nashville", coords: [36.1627, -86.7816] },
        { name: "Charlotte", coords: [35.2271, -80.8431] }
      ]
    };

    const decadeLabel = document.getElementById("decade");
    const scaleFill = document.getElementById("scaleFill");
    const mapEl = document.getElementById("map");
    const decades = Object.keys(cityGrowth);
    let i = 0;

    // Function to show each decade
    function showNextDecade() {
      if (i >= decades.length) return;
      const decade = decades[i];
      decadeLabel.textContent = decade;

      // Brighten the map slightly
      const brightness = 0.4 + i * 0.12;
      mapEl.style.filter = `brightness(${brightness})`;

      // Fill the urbanization scale
      const fillPercent = ((i + 1) / decades.length) * 100;
      scaleFill.style.width = `${fillPercent}%`;

      // Add glowing cities
      cityGrowth[decade].forEach(city => {
        const icon = L.divIcon({
          className: 'city-glow'
        });

        const marker = L.marker(city.coords, { icon }).addTo(map);

        setTimeout(() => {
          const el = marker.getElement();
          if (el) el.style.opacity = 1;
        }, 500);
      });

      i++;
      setTimeout(showNextDecade, 4000);
    }

    showNextDecade();
  </script>
</body>
</html>
